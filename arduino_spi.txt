SS pin on Arduino Pro Micro board
Oct 05, 2016, 04:46 pm
Hello,

I've been trying to do a simple SPI communication between 2 Arduino boards. Nano as a master and Pro Micro as a slave.

So, the code I wrote didn't work. So I posted a thread on stack overflow, and they told me that I have to pull the SS pin on the slave side.

I found the SS pin on the Nano board, but didn't find it on the Pro Micro board.

Pro Micro pinout



And also, there are 32u4 pin layout but it's for Leonardo board which is different than pro micro board, like this one:

atmel-atmega32u4-pinout-diagram

KeithRB

    avatar_KeithRB
    **
    Faraday Member
    Posts: 3,888
    Karma: 394  [add]

Re: SS pin on Arduino Pro Micro board
#1
Oct 05, 2016, 04:52 pm
What do you mean by "pull the pin on the slave side"? Usually the master has full control over the SS pin, and the slave merely listens to know when it is being accessed.
DrAzzy

    avatar_DrAzzy
    ****
    ATtiny Obsessee
    Shannon Member
    Posts: 10,810
    Karma: 1582  [add]
    https://www.tindie.com/stores/DrAzzy/

Re: SS pin on Arduino Pro Micro board
#2
Oct 05, 2016, 06:02 pm Last Edit: Oct 05, 2016, 06:03 pm by DrAzzy
The SS pin on the slave is supposed to be brought low to tell it that it's being talked to, and otherwise kept high. On the master, I think the SS pin needs to be kept as an OUTPUT or high.

On the micro, this pin is PB0... which appears to be used for the RX light, and isn't broken out.

Mangle or remove the LED, solder (and glue in place, else it'll fatigue and break) a wire to the end that goes to the chip, and there's your connection point.

It's digital pin 17 from within code.
ATTinyCore for x4/x5/x61/x7/x8/x41/1634/828/x313 megaTinyCore for the megaavr ATtinies - Board Manager:
http://drazzy.com/package_drazzy.com_index.json
ATtiny breakouts, mosfets, awesome prototyping board in my store http://tindie.com/stores/DrAzzy
wolfrose

    avatar_wolfrose
    ***
    Full Member
    Posts: 178
    Karma: 25  [add]

Re: SS pin on Arduino Pro Micro board
#3
Oct 05, 2016, 06:14 pm
Quote from: KeithRB on Oct 05, 2016, 04:52 pm

    What do you mean by "pull the pin on the slave side"? Usually the master has full control over the SS pin, and the slave merely listens to know when it is being accessed.

Yes, I know I have to configure it as o/p high on master and I/p high on slave.
But I couldn't find it on pro micro board.


Quote from: DrAzzy on Oct 05, 2016, 06:02 pm

    The SS pin on the slave is supposed to be brought low to tell it that it's being talked to, and otherwise kept high. On the master, I think the SS pin needs to be kept as an OUTPUT or high.

    On the micro, this pin is PB0... which appears to be used for the RX light, and isn't broken out.

    Mangle or remove the LED, solder (and glue in place, else it'll fatigue and break) a wire to the end that goes to the chip, and there's your connection point.

    It's digital pin 17 from within code.

No, I don't want to do this modification.

OK, I want to understand if they didn't include the SS pin on the I/O pins, then how the pro micro suppose to work? would it work with only 3 pins? MOSI MISO SCK.
KeithRB

    avatar_KeithRB
    **
    Faraday Member
    Posts: 3,888
    Karma: 394  [add]

Re: SS pin on Arduino Pro Micro board
#4
Oct 05, 2016, 06:27 pm
*Any* pin can be SS, that is under your control. That way you can talk to multiple SPI devices.
DrAzzy

    avatar_DrAzzy
    ****
    ATtiny Obsessee
    Shannon Member
    Posts: 10,810
    Karma: 1582  [add]
    https://www.tindie.com/stores/DrAzzy/

Re: SS pin on Arduino Pro Micro board
#5
Oct 05, 2016, 06:30 pm Last Edit: Oct 05, 2016, 06:31 pm by DrAzzy
Works as a master no prob (you can easily use a different pin on the master to drive the slave's SS pin), but maybe not as a slave... I'm not that familiar with slave SPI operation, not sure if you need to use the SS pin for slave.

And yeah, I realized that mod wouldn't work without you defanging the use of that port in response to serial use, meaning hacking around in the core...
ATTinyCore for x4/x5/x61/x7/x8/x41/1634/828/x313 megaTinyCore for the megaavr ATtinies - Board Manager:
http://drazzy.com/package_drazzy.com_index.json
ATtiny breakouts, mosfets, awesome prototyping board in my store http://tindie.com/stores/DrAzzy
wolfrose

    avatar_wolfrose
    ***
    Full Member
    Posts: 178
    Karma: 25  [add]

Re: SS pin on Arduino Pro Micro board
#6
Oct 05, 2016, 06:39 pm
Quote from: KeithRB on Oct 05, 2016, 06:27 pm

    *Any* pin can be SS, that is under your control. That way you can talk to multiple SPI devices.

I know it could be any pin on the master side, but has to be specific one on the slave side which is not specified on the pinout of the pro micro board.

But I think since they didn't include in in the I/O of the pro micro then it's not important.

I tried different boards but didn't work I think the problem in my code.

Which I have to include now in this thread or another one.


Quote from: DrAzzy on Oct 05, 2016, 06:30 pm

    not sure if you need to use the SS pin for slave.

That's what I want to figure out, but since they didn't include it on pro micro pinout then it's not important.

Because I changed the boards and configured the SS pin and pulled it low and the code didn't work. The TX function is not compiling and executing the next line.
CrossRoads

    avatar_CrossRoads
    *****
    Global Moderator
    Unlimited Eagle board sizes available.
    Brattain Member
    Posts: 43,146
    Karma: 1893  [add]
    Author of "Arduino for Teens". Available for Design & Build services. Now with Unlimited Eagle board sizes!
    http://www.crossroadsfencing.com/BobuinoRev17/

Re: SS pin on Arduino Pro Micro board
#7
Oct 05, 2016, 06:51 pm
ProMicro uses Atmega32U4, yes? Then for it to be an SPI slave, the SPI master must have access to the 32U4's SS pin, which is PB0, physical pin 8. If it's not broken out to a header pin, wire the pin to an used signal header and use that.
Designing & building electrical circuits for over 25 years.  Screw Shield for Mega/Due/Uno,  Bobuino with ATMega1284P, & other '328P & '1284P creations & offerings at  my website.
CrossRoads

    avatar_CrossRoads
    *****
    Global Moderator
    Unlimited Eagle board sizes available.
    Brattain Member
    Posts: 43,146
    Karma: 1893  [add]
    Author of "Arduino for Teens". Available for Design & Build services. Now with Unlimited Eagle board sizes!
    http://www.crossroadsfencing.com/BobuinoRev17/

Re: SS pin on Arduino Pro Micro board
#8
Oct 05, 2016, 06:58 pm Last Edit: Oct 05, 2016, 06:59 pm by CrossRoads
Like chip physical pin 8 to header D7, and then don't use D7 for the project.
And the Rx LED may do weird stuff as SS is controlled externally.
https://www.arduino.cc/en/Main/ArduinoBoardMicro
https://www.arduino.cc/en/uploads/Main/arduino-micro-schematic.pdf

Designing & building electrical circuits for over 25 years.  Screw Shield for Mega/Due/Uno,  Bobuino with ATMega1284P, & other '328P & '1284P creations & offerings at  my website.
CrossRoads

    avatar_CrossRoads
    *****
    Global Moderator
    Unlimited Eagle board sizes available.
    Brattain Member
    Posts: 43,146
    Karma: 1893  [add]
    Author of "Arduino for Teens". Available for Design & Build services. Now with Unlimited Eagle board sizes!
    http://www.crossroadsfencing.com/BobuinoRev17/

Re: SS pin on Arduino Pro Micro board
#9
Oct 05, 2016, 09:06 pm
And I missed it - the RxLED/SS pin is pin2 on the J5 header, no wiring needed.
Designing & building electrical circuits for over 25 years.  Screw Shield for Mega/Due/Uno,  Bobuino with ATMega1284P, & other '328P & '1284P creations & offerings at  my website.
wolfrose

    avatar_wolfrose
    ***
    Full Member
    Posts: 178
    Karma: 25  [add]

Re: SS pin on Arduino Pro Micro board
#10
Oct 06, 2016, 02:28 am
Quote from: CrossRoads on Oct 05, 2016, 06:51 pm

    ProMicro uses Atmega32U4, yes? Then for it to be an SPI slave, the SPI master must have access to the 32U4's SS pin, which is PB0, physical pin 8. If it's not broken out to a header pin, wire the pin to an used signal header and use that.

What I'm wondering about is that if they omit the SS pin then how we can connect to the SS?
Also, I think if they omit the SS connection, then it would be not so important to connect this pin in SPI operation. I guess!



Quote from: CrossRoads on Oct 05, 2016, 06:58 pm

    Like chip physical pin 8 to header D7, and then don't use D7 for the project.
    And the Rx LED may do weird stuff as SS is controlled externally.
    https://www.arduino.cc/en/Main/ArduinoBoardMicro
    https://www.arduino.cc/en/uploads/Main/arduino-micro-schematic.pdf


Thanks for the links but it was so difficult to connect the wiring of the schematic to the actual pro micro pinout.

I have the clone version, like this one:




Quote from: CrossRoads on Oct 05, 2016, 09:06 pm

    And I missed it - the RxLED/SS pin is pin2 on the J5 header, no wiring needed.

I wrote a code to blink PB0, so the RX LED is blinking and I connected another LED to the other pins of the board and it turns out that the RX and TX LEDs are connected directly from the chip to the LEDs with no sharing to pins.
CrossRoads

    avatar_CrossRoads
    *****
    Global Moderator
    Unlimited Eagle board sizes available.
    Brattain Member
    Posts: 43,146
    Karma: 1893  [add]
    Author of "Arduino for Teens". Available for Design & Build services. Now with Unlimited Eagle board sizes!
    http://www.crossroadsfencing.com/BobuinoRev17/

Re: SS pin on Arduino Pro Micro board
#11
Oct 06, 2016, 04:37 am
"it turns out that the RX and TX LEDs are connected directly from the chip to the LEDs with no sharing to pins."

So run a wire from the Rx LED or it's current limiting resistor (buzz out with a meter to see which connects to pin 8 directly) and connect to an IO pin.

You need SS pin access to run the board as an SPI slave, that is clearly stated in the 32U4 datasheet.
Designing & building electrical circuits for over 25 years.  Screw Shield for Mega/Due/Uno,  Bobuino with ATMega1284P, & other '328P & '1284P creations & offerings at  my website.
wolfrose

    avatar_wolfrose
    ***
    Full Member
    Posts: 178
    Karma: 25  [add]

Re: SS pin on Arduino Pro Micro board
#12
Oct 07, 2016, 04:36 pm
Quote from: CrossRoads on Oct 06, 2016, 04:37 am

    "it turns out that the RX and TX LEDs are connected directly from the chip to the LEDs with no sharing to pins."

    So run a wire from the Rx LED or it's current limiting resistor (buzz out with a meter to see which connects to pin 8 directly) and connect to an IO pin.

    You need SS pin access to run the board as an SPI slave, that is clearly stated in the 32U4 datasheet.

OK I understand, but why they didn't connect it to I/O pin? While they know SS is mandatory for SPI operation? Is it that this board isn't intended for SPI operations or what is the principle here of omitting the SS pin from the I/O pins?
uxomm

    avatar_uxomm
    *
    Edison Member
    Posts: 1,690
    Karma: 277  [add]

Re: SS pin on Arduino Pro Micro board
#13
Oct 09, 2016, 01:47 pm
Quote from: wolfrose on Oct 07, 2016, 04:36 pm

    OK I understand, but why they didn't connect it to I/O pin? While they know SS is mandatory for SPI operation? Is it that this board isn't intended for SPI operations or what is the principle here of omitting the SS pin from the I/O pins?

I think this is just bad design. :)

Like (many) other things with Arduino.
One example only - with older boards: placing the reset button almost in the "middle" of the pcb so there is no way to press it when you have a shield installed...

By the way: I like Arduino :)
Always decouple electronic circuitry.
wolfrose

    avatar_wolfrose
    ***
    Full Member
    Posts: 178
    Karma: 25  [add]

Re: SS pin on Arduino Pro Micro board
#14
Oct 09, 2016, 02:06 pm
Quote from: uxomm on Oct 09, 2016, 01:47 pm

    I think this is just bad design. :)

    Like (many) other things with Arduino.
    One example only - with older boards: placing the reset button almost in the "middle" of the pcb so there is no way to press it when you have a shield installed...

    By the way: I like Arduino :)

Absolutely :)

Me too !


Anyway, I'm now working with Uno and Nano boards. Still having problems running default SPI codes in the datasheet.
